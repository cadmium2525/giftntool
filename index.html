<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒ•ã‚¡ãƒ¼ãƒ  ç›¸æ€§ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght=100..900&display=swap" rel="stylesheet">
    <style>
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ«: ãƒ¢ãƒã‚¤ãƒ«ã§ã®è¦–èªæ€§å‘ä¸Šã¨ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã®èª¿æ•´ */
        :root {
            --color-primary: #1e3a8a; /* Indigo 800 */
            --color-accent: #3b82f6; /* Blue 500 */
            --color-background: #111827; /* Gray 900 */
            --color-surface: #1f2937; /* Gray 800 */
            --color-text: #f3f4f6; /* Gray 100 */
            --color-border: #374151; /* Gray 700 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            /* ã‚¹ãƒ ãƒ¼ã‚ºãªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
            scroll-behavior: smooth;
        }

        /* iFrameã®ãƒ•ãƒ«ãƒã‚¤ãƒˆèª¿æ•´ */
        #iframe-container {
            height: 80vh; /* ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆã®80%ã‚’iFrameã«å‰²ã‚Šå½“ã¦ã‚‹ */
            min-height: 400px;
        }

        /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã®è‰²ã‚’ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã«åˆã‚ã›ã‚‹ (Chrome/Edge/Safari) */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--color-surface);
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* Gray 600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* Gray 500 */
        }

        /* 5åˆ—ã‚°ãƒªãƒƒãƒ‰ã‚’ãƒ¢ãƒã‚¤ãƒ«ã§èª¿æ•´ */
        .result-grid {
            display: grid;
            grid-template-columns: repeat(5, minmax(0, 1fr));
            gap: 8px;
        }
        /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯3åˆ—ã«ç¸®å° */
        @media (max-width: 768px) {
            .result-grid {
                grid-template-columns: repeat(3, minmax(0, 1fr));
            }
        }
        /* éå¸¸ã«å°ã•ã„ç”»é¢ã§ã¯2åˆ—ã«ç¸®å° */
        @media (max-width: 480px) {
            .result-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        /* ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚³ãƒ³ãƒ†ãƒŠã‚¹ã‚¿ã‚¤ãƒ« */
        .monster-icon-container {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden; /* ç”»åƒã‚’ä¸¸ãã‚¯ãƒªãƒƒãƒ— */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            border: 2px solid transparent; /* åˆæœŸãƒœãƒ¼ãƒ€ãƒ¼ */
        }
        .monster-icon-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* é¸æŠãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .monster-select-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            padding: 0 10px;
            border-radius: 0.5rem;
            text-align: center;
            transition: transform 0.1s, box-shadow 0.1s;
        }
        .monster-select-btn:hover {
            transform: scale(1.02);
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«èƒŒæ™¯ */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }

        /* ãƒœã‚¿ãƒ³ã®ãƒ›ãƒãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ */
        .control-button {
            transition: background-color 0.2s, transform 0.1s;
        }
        .control-button:active {
            transform: scale(0.95);
        }

        /* ç›¸æ€§ã‚·ãƒ³ãƒœãƒ«ã®è‰²ä»˜ã‘ */
        .symbol-x { color: #f87171; /* Red 400 */ }
        .symbol-triangle { color: #fbbf24; /* Amber 400 */ }
        .symbol-circle { color: #34d399; /* Emerald 400 */ }
        .symbol-double-circle { color: #3b82f6; /* Blue 500 */ }
        .symbol-star { color: #facc15; /* Yellow 400 */ }
        .symbol-crown { color: #a78bfa; /* Violet 400 */ }

    </style>
</head>
<body class="p-4 sm:p-6 md:p-8">

    <!-- iFrameåŸ‹ã‚è¾¼ã¿ã‚¨ãƒªã‚¢ -->
    <section id="iframe-section" class="mb-8">
        <h1 class="text-3xl font-bold text-center mb-4 text-white">LINE MF ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼åŸ‹ã‚è¾¼ã¿</h1>
        <div id="iframe-container" class="w-full rounded-xl overflow-hidden shadow-2xl border border-gray-700">
            <iframe
                src="https://monster-farm-simulator.onrender.com"
                frameborder="0"
                class="w-full h-full"
                title="å¤–éƒ¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼"
            ></iframe>
        </div>
    </section>

    <!-- ç›¸æ€§æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ -->
    <section id="tool-section" class="bg-gray-800 p-4 sm:p-6 rounded-xl shadow-2xl border border-gray-700">
        <h2 class="text-2xl font-bold text-center mb-6 text-indigo-400">ç›¸æ€§æ¤œç´¢ãƒ„ãƒ¼ãƒ«</h2>

        <!-- 1. ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼é¸æŠã‚¨ãƒªã‚¢ -->
        <div id="monster-selection" class="mb-8 p-4 bg-gray-900 rounded-lg border border-gray-700">
            <h3 class="text-xl font-semibold mb-3 text-indigo-300">â‘  è‚²æˆç³»çµ±ã®é¸æŠ (6ä½“)</h3>
            <div class="grid grid-cols-2 gap-4">

                <!-- çˆ¶è¦ªç³»çµ± -->
                <div class="space-y-3 p-3 bg-gray-700 rounded-lg">
                    <p class="font-medium text-lg text-yellow-300 border-b border-gray-600 pb-2">çˆ¶è¦ªç³»çµ±</p>
                    <div class="flex items-center space-x-2">
                        <div class="monster-icon-container" id="icon-P1">
                            <span class="text-sm font-bold text-white">?</span>
                        </div>
                        <button id="select-father" class="monster-select-btn bg-blue-600 p-2 rounded-lg text-sm transition-colors hover:bg-blue-700 flex-grow" data-target="P1">çˆ¶è¦ªã‚’é¸æŠ</button>
                    </div>
                    <div class="flex items-center space-x-2">
                         <div class="monster-icon-container" id="icon-Gf1">
                            <span class="text-sm font-bold text-white">?</span>
                        </div>
                        <button id="select-gfather1" class="monster-select-btn bg-blue-600 p-2 rounded-lg text-sm transition-colors hover:bg-blue-700 flex-grow" data-target="Gf1">ç¥–çˆ¶ (çˆ¶å´)ã‚’é¸æŠ</button>
                    </div>
                    <div class="flex items-center space-x-2">
                         <div class="monster-icon-container" id="icon-Gm1">
                            <span class="text-sm font-bold text-white">?</span>
                        </div>
                        <button id="select-gmother1" class="monster-select-btn bg-blue-600 p-2 rounded-lg text-sm transition-colors hover:bg-blue-700 flex-grow" data-target="Gm1">ç¥–æ¯ (çˆ¶å´)ã‚’é¸æŠ</button>
                    </div>
                </div>

                <!-- æ¯è¦ªç³»çµ± -->
                <div class="space-y-3 p-3 bg-gray-700 rounded-lg">
                    <p class="font-medium text-lg text-pink-300 border-b border-gray-600 pb-2">æ¯è¦ªç³»çµ±</p>
                    <div class="flex items-center space-x-2">
                        <div class="monster-icon-container" id="icon-P2">
                            <span class="text-sm font-bold text-white">?</span>
                        </div>
                        <button id="select-mother" class="monster-select-btn bg-purple-600 p-2 rounded-lg text-sm transition-colors hover:bg-purple-700 flex-grow" data-target="P2">æ¯è¦ªã‚’é¸æŠ</button>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="monster-icon-container" id="icon-Gf2">
                            <span class="text-sm font-bold text-white">?</span>
                        </div>
                        <button id="select-gfather2" class="monster-select-btn bg-purple-600 p-2 rounded-lg text-sm transition-colors hover:bg-purple-700 flex-grow" data-target="Gf2">ç¥–çˆ¶ (æ¯å´)ã‚’é¸æŠ</button>
                    </div>
                    <div class="flex items-center space-x-2">
                         <div class="monster-icon-container" id="icon-Gm2">
                            <span class="text-sm font-bold text-white">?</span>
                        </div>
                        <button id="select-gmother2" class="monster-select-btn bg-purple-600 p-2 rounded-lg text-sm transition-colors hover:bg-purple-700 flex-grow" data-target="Gm2">ç¥–æ¯ (æ¯å´)ã‚’é¸æŠ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. æ¤œç´¢æ¡ä»¶å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div id="condition-input" class="mb-8 p-4 bg-gray-900 rounded-lg border border-gray-700">
            <h3 class="text-xl font-semibold mb-4 text-indigo-300">â‘¡ æ¤œç´¢æ¡ä»¶ã®å…¥åŠ›</h3>

            <!-- å…±é€šç§˜ä¼â…¢ -->
            <div class="flex items-center justify-between mb-4">
                <label for="secret3" class="text-base font-medium text-gray-300 w-1/3">å…±é€šç§˜ä¼â…¢ã®æ•°</label>
                <div class="flex items-center w-2/3 space-x-1">
                    <button class="control-button bg-red-600 hover:bg-red-700 text-white rounded-l-lg px-2 py-1 text-lg" onclick="adjustValue('secret3', -5)">-5</button>
                    <button class="control-button bg-red-400 hover:bg-red-500 text-white px-2 py-1 text-lg" onclick="adjustValue('secret3', -1)">-1</button>
                    <input type="number" id="secret3" value="0" min="0" max="6" class="w-full text-center p-2 rounded-sm bg-gray-700 border-gray-600 focus:ring-blue-500 focus:border-blue-500 appearance-none text-white text-lg">
                    <button class="control-button bg-green-400 hover:bg-green-500 text-white px-2 py-1 text-lg" onclick="adjustValue('secret3', 1)">+1</button>
                    <button class="control-button bg-green-600 hover:bg-green-700 text-white rounded-r-lg px-2 py-1 text-lg" onclick="adjustValue('secret3', 5)">+5</button>
                </div>
            </div>

            <!-- å…±é€šç§˜ä¼â…¡ -->
            <div class="flex items-center justify-between mb-4">
                <label for="secret2" class="text-base font-medium text-gray-300 w-1/3">å…±é€šç§˜ä¼â…¡ã®æ•°</label>
                <div class="flex items-center w-2/3 space-x-1">
                    <button class="control-button bg-red-600 hover:bg-red-700 text-white rounded-l-lg px-2 py-1 text-lg" onclick="adjustValue('secret2', -5)">-5</button>
                    <button class="control-button bg-red-400 hover:bg-red-500 text-white px-2 py-1 text-lg" onclick="adjustValue('secret2', -1)">-1</button>
                    <input type="number" id="secret2" value="0" min="0" max="12" class="w-full text-center p-2 rounded-sm bg-gray-700 border-gray-600 focus:ring-blue-500 focus:border-blue-500 appearance-none text-white text-lg">
                    <button class="control-button bg-green-400 hover:bg-green-500 text-white px-2 py-1 text-lg" onclick="adjustValue('secret2', 1)">+1</button>
                    <button class="control-button bg-green-600 hover:bg-green-700 text-white rounded-r-lg px-2 py-1 text-lg" onclick="adjustValue('secret2', 5)">+5</button>
                </div>
            </div>

            <!-- ãƒãƒ¼ãƒ–ãƒ«åŠ ç®— -->
            <div class="flex items-center justify-between">
                <label for="noble-add" class="text-base font-medium text-gray-300 w-1/3">ãƒãƒ¼ãƒ–ãƒ«åŠ ç®—</label>
                <input type="number" id="noble-add" value="0" class="w-2/3 text-center p-2 rounded-lg bg-gray-700 border border-gray-600 focus:ring-blue-500 focus:border-blue-500 text-white text-lg">
            </div>

            <button id="calculate-btn" class="mt-6 w-full py-3 bg-indigo-500 text-white font-bold rounded-lg shadow-lg hover:bg-indigo-600 transition-colors text-xl">
                ç›¸æ€§å€¤ã‚’è¨ˆç®—ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
            </button>
        </div>

        <!-- 3. çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div id="results" class="p-4 bg-gray-900 rounded-lg border border-gray-700 min-h-32">
            <h3 class="text-xl font-semibold mb-4 text-indigo-300">â‘¢ ç›¸æ€§å€¤ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h3>
            <div id="error-message" class="text-red-400 mb-4 hidden"></div>
            <div id="result-list" class="result-grid">
                <!-- çµæœã¯ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                <p class="col-span-full text-center text-gray-500 mt-8">â¬†ï¸ ä¸Šã®é …ç›®ã‚’é¸æŠãƒ»å…¥åŠ›ã—ã€ã€Œè¨ˆç®—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
        </div>

    </section>

    <!-- ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="monster-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center z-50 modal-overlay">
        <div class="bg-gray-800 p-6 rounded-xl shadow-3xl max-w-lg w-11/12 max-h-[90vh] overflow-y-auto border border-indigo-500">
            <h3 class="text-2xl font-bold mb-4 text-indigo-400" id="modal-title">ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠ</h3>
            <div id="monster-list" class="grid grid-cols-4 sm:grid-cols-5 gap-3">
                <!-- ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³ãŒJavaScriptã§æŒ¿å…¥ã•ã‚Œã¾ã™ -->
            </div>
            <button class="mt-6 w-full py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500" onclick="closeModal()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // =================================================================
        // 1. ãƒ‡ãƒ¼ã‚¿å®šç¾© (ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®ãŸã‚ã«ã“ã“ã«é›†ç´„)
        // =================================================================

        // ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼åã¨ã‚¢ã‚¤ã‚³ãƒ³ãƒ‡ãƒ¼ã‚¿
        // NOTE: GitHub Pagesã‚’æƒ³å®šã—ã€ç›¸å¯¾ãƒ‘ã‚¹ï¼ˆimage/ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å.pngï¼‰ã«ä¿®æ­£ã—ã¾ã—ãŸã€‚
        // å®Ÿéš›ã«ã”åˆ©ç”¨ã®éš›ã¯ã€ã“ã®ãƒ‘ã‚¹ã«ç”»åƒã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚
        const MONSTERS = [
            { name: "ãƒ”ã‚¯ã‚·ãƒ¼", short: "PI", color: "#f87171", imageUrl: "image/ãƒ”ã‚¯ã‚·ãƒ¼.png" },
            { name: "ãƒ‰ãƒ©ã‚´ãƒ³", short: "DR", color: "#3b82f6", imageUrl: "image/ãƒ‰ãƒ©ã‚´ãƒ³.png" },
            { name: "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹", short: "KE", color: "#10b981", imageUrl: "image/ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹.png" },
            { name: "ãƒ¢ãƒãƒªã‚¹", short: "MO", color: "#f59e0b", imageUrl: "image/ãƒ¢ãƒãƒªã‚¹.png" },
            { name: "ãƒ©ã‚¤ã‚¬ãƒ¼", short: "RA", color: "#a855f7", imageUrl: "image/ãƒ©ã‚¤ã‚¬ãƒ¼.png" },
            { name: "ãƒ˜ãƒ³ã‚¬ãƒ¼", short: "HE", color: "#34d399", imageUrl: "image/ãƒ˜ãƒ³ã‚¬ãƒ¼.png" },
            { name: "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³", short: "DU", color: "#475569", imageUrl: "image/ãƒ‡ãƒ¥ãƒ©ãƒãƒ³.png" },
            { name: "ã‚¹ã‚¨ã‚¾ãƒ¼", short: "SU", color: "#f472b6", imageUrl: "image/ã‚¹ã‚¨ã‚¾ãƒ¼.png" },
            { name: "ãƒŠãƒ¼ã‚¬", short: "NA", color: "#60a5fa", imageUrl: "image/ãƒŠãƒ¼ã‚¬.png" },
            { name: "ã‚¬ãƒª", short: "GA", color: "#fb7185", imageUrl: "image/ã‚¬ãƒª.png" }
        ];
        const MONSTER_NAMES = MONSTERS.map(m => m.name);

        // åŸºç¤ç›¸æ€§å€¤ãƒ†ãƒ¼ãƒ–ãƒ« (Younger Generation : Older Generation)
        // ã‚­ãƒ¼: è‹¥ã„ä¸–ä»£ (å­/è¦ª) ã®åå‰
        // å€¤: { å¤ã„ä¸–ä»£ (è¦ª/ç¥–çˆ¶æ¯) ã®åå‰ : ç›¸æ€§å€¤ }
        const BASE_COMPATIBILITY = {
            "ãƒ”ã‚¯ã‚·ãƒ¼": { "ãƒ”ã‚¯ã‚·ãƒ¼": 16, "ãƒ‰ãƒ©ã‚´ãƒ³": 14.5, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 20.5, "ãƒ¢ãƒãƒªã‚¹": 18, "ãƒ©ã‚¤ã‚¬ãƒ¼": 22, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 17, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 19, "ã‚¹ã‚¨ã‚¾ãƒ¼": 15, "ãƒŠãƒ¼ã‚¬": 16, "ã‚¬ãƒª": 21 },
            "ãƒ‰ãƒ©ã‚´ãƒ³": { "ãƒ”ã‚¯ã‚·ãƒ¼": 15, "ãƒ‰ãƒ©ã‚´ãƒ³": 16, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 27, "ãƒ¢ãƒãƒªã‚¹": 20, "ãƒ©ã‚¤ã‚¬ãƒ¼": 18, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 25, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 15, "ã‚¹ã‚¨ã‚¾ãƒ¼": 23, "ãƒŠãƒ¼ã‚¬": 21, "ã‚¬ãƒª": 19 },
            "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": { "ãƒ”ã‚¯ã‚·ãƒ¼": 23, "ãƒ‰ãƒ©ã‚´ãƒ³": 27, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 16, "ãƒ¢ãƒãƒªã‚¹": 14, "ãƒ©ã‚¤ã‚¬ãƒ¼": 20, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 21, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 22, "ã‚¹ã‚¨ã‚¾ãƒ¼": 25, "ãƒŠãƒ¼ã‚¬": 17, "ã‚¬ãƒª": 16.5 },
            "ãƒ¢ãƒãƒªã‚¹": { "ãƒ”ã‚¯ã‚·ãƒ¼": 16.5, "ãƒ‰ãƒ©ã‚´ãƒ³": 15, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 20, "ãƒ¢ãƒãƒªã‚¹": 16, "ãƒ©ã‚¤ã‚¬ãƒ¼": 23, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 19, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 20, "ã‚¹ã‚¨ã‚¾ãƒ¼": 18, "ãƒŠãƒ¼ã‚¬": 22, "ã‚¬ãƒª": 15 },
            "ãƒ©ã‚¤ã‚¬ãƒ¼": { "ãƒ”ã‚¯ã‚·ãƒ¼": 18, "ãƒ‰ãƒ©ã‚´ãƒ³": 19, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 15, "ãƒ¢ãƒãƒªã‚¹": 25, "ãƒ©ã‚¤ã‚¬ãƒ¼": 16, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 22, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 17, "ã‚¹ã‚¨ã‚¾ãƒ¼": 20.5, "ãƒŠãƒ¼ã‚¬": 14, "ã‚¬ãƒª": 25 },
            "ãƒ˜ãƒ³ã‚¬ãƒ¼": { "ãƒ”ã‚¯ã‚·ãƒ¼": 20, "ãƒ‰ãƒ©ã‚´ãƒ³": 21, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 23, "ãƒ¢ãƒãƒªã‚¹": 17, "ãƒ©ã‚¤ã‚¬ãƒ¼": 15.5, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 16, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 21, "ã‚¹ã‚¨ã‚¾ãƒ¼": 16, "ãƒŠãƒ¼ã‚¬": 20, "ã‚¬ãƒª": 18 },
            "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": { "ãƒ”ã‚¯ã‚·ãƒ¼": 17, "ãƒ‰ãƒ©ã‚´ãƒ³": 20, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 18, "ãƒ¢ãƒãƒªã‚¹": 21, "ãƒ©ã‚¤ã‚¬ãƒ¼": 23, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 15, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 16, "ã‚¹ã‚¨ã‚¾ãƒ¼": 19, "ãƒŠãƒ¼ã‚¬": 18.5, "ã‚¬ãƒª": 24 },
            "ã‚¹ã‚¨ã‚¾ãƒ¼": { "ãƒ”ã‚¯ã‚·ãƒ¼": 22, "ãƒ‰ãƒ©ã‚´ãƒ³": 17.5, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 19, "ãƒ¢ãƒãƒªã‚¹": 24, "ãƒ©ã‚¤ã‚¬ãƒ¼": 16, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 20, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 23, "ã‚¹ã‚¨ã‚¾ãƒ¼": 16, "ãƒŠãƒ¼ã‚¬": 15, "ã‚¬ãƒª": 17 },
            "ãƒŠãƒ¼ã‚¬": { "ãƒ”ã‚¯ã‚·ãƒ¼": 19, "ãƒ‰ãƒ©ã‚´ãƒ³": 24, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 15, "ãƒ¢ãƒãƒªã‚¹": 17, "ãƒ©ã‚¤ã‚¬ãƒ¼": 21, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 18.5, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 25, "ã‚¹ã‚¨ã‚¾ãƒ¼": 20, "ãƒŠãƒ¼ã‚¬": 16, "ã‚¬ãƒª": 14.5 },
            "ã‚¬ãƒª": { "ãƒ”ã‚¯ã‚·ãƒ¼": 14, "ãƒ‰ãƒ©ã‚´ãƒ³": 18, "ã‚±ãƒ³ã‚¿ã‚¦ãƒ­ã‚¹": 22, "ãƒ¢ãƒãƒªã‚¹": 15.5, "ãƒ©ã‚¤ã‚¬ãƒ¼": 19, "ãƒ˜ãƒ³ã‚¬ãƒ¼": 24, "ãƒ‡ãƒ¥ãƒ©ãƒãƒ³": 17, "ã‚¹ã‚¨ã‚¾ãƒ¼": 21, "ãƒŠãƒ¼ã‚¬": 23, "ã‚¬ãƒª": 16 },
        };

        // =================================================================
        // 2. çŠ¶æ…‹ç®¡ç†
        // =================================================================

        // é¸æŠã•ã‚ŒãŸ6ä½“ã®ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã®çŠ¶æ…‹
        const state = {
            P1: null, Gf1: null, Gm1: null,
            P2: null, Gf2: null, Gm2: null,
            currentSelectionTarget: null,
        };

        // =================================================================
        // 3. UIæ“ä½œé–¢æ•°
        // =================================================================

        /**
         * ç§˜ä¼/åŠ ç®—å€¤ã®èª¿æ•´ãƒœã‚¿ãƒ³ã®å‡¦ç†
         */
        function adjustValue(id, delta) {
            const input = document.getElementById(id);
            let currentValue = parseInt(input.value) || 0;
            let newValue = currentValue + delta;

            if (id !== 'noble-add') {
                if (newValue < 0) newValue = 0;
            }
            
            if (id === 'secret3' && newValue > 6) newValue = 6;
            if (id === 'secret2' && newValue > 12) newValue = 12;

            input.value = newValue;
        }

        /**
         * ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
         */
        function openModal(targetKey) {
            state.currentSelectionTarget = targetKey;
            const modal = document.getElementById('monster-modal');
            const title = document.getElementById('modal-title');
            
            let titleText = "";
            switch(targetKey) {
                case 'P1': titleText = 'çˆ¶è¦ª'; break;
                case 'Gf1': titleText = 'ç¥–çˆ¶ (çˆ¶å´)'; break;
                case 'Gm1': titleText = 'ç¥–æ¯ (çˆ¶å´)'; break;
                case 'P2': titleText = 'æ¯è¦ª'; break;
                case 'Gf2': titleText = 'ç¥–çˆ¶ (æ¯å´)'; break;
                case 'Gm2': titleText = 'ç¥–æ¯ (æ¯å´)'; break;
            }
            title.textContent = `${titleText}ã®é¸æŠ`;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        /**
         * ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
         */
        function closeModal() {
            const modal = document.getElementById('monster-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            state.currentSelectionTarget = null;
        }

        /**
         * ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãŒé¸æŠã•ã‚ŒãŸæ™‚ã®å‡¦ç†
         */
        function selectMonster(monsterName) {
            if (!state.currentSelectionTarget) return;

            // çŠ¶æ…‹ã‚’æ›´æ–°
            state[state.currentSelectionTarget] = monsterName;

            // UIã‚’æ›´æ–° (ãƒœã‚¿ãƒ³ã¨ã‚¢ã‚¤ã‚³ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ)
            const targetButton = document.querySelector(`[data-target="${state.currentSelectionTarget}"]`);
            const iconContainer = document.getElementById(`icon-${state.currentSelectionTarget}`);
            const monsterData = MONSTERS.find(m => m.name === monsterName);
            
            if (targetButton && iconContainer && monsterData) {
                // ãƒœã‚¿ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆæ›´æ–°
                let parentType = '';
                if (state.currentSelectionTarget === 'P1') parentType = 'çˆ¶è¦ª';
                else if (state.currentSelectionTarget === 'P2') parentType = 'æ¯è¦ª';
                else if (state.currentSelectionTarget.includes('f')) parentType = 'ç¥–çˆ¶';
                else if (state.currentSelectionTarget.includes('m')) parentType = 'ç¥–æ¯';

                targetButton.textContent = `${monsterName} (${parentType})`;
                targetButton.classList.add('font-semibold', 'text-sm');

                // ã‚¢ã‚¤ã‚³ãƒ³ã®æ›´æ–° (<img>ã‚¿ã‚°ã‚’æŒ¿å…¥)
                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§ã‚’è©¦ã¿ã‚‹ã€‚å¤±æ•—æ™‚ã¯ã‚¤ãƒ‹ã‚·ãƒ£ãƒ«ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚
                iconContainer.innerHTML = `<img src="${monsterData.imageUrl}" alt="${monsterName} icon" class="monster-icon-img" 
                    onerror="this.parentNode.innerHTML='<span class=\\'text-sm font-bold text-white\\' style=\\'background-color: ${monsterData.color}; padding: 0.5rem; border-radius: 50%;\\'>${monsterData.short}</span>'; this.parentNode.style.backgroundColor='transparent';" />`;
                iconContainer.style.border = '2px solid #3b82f6'; // é¸æŠã•ã‚ŒãŸã“ã¨ã‚’ç¤ºã™
                iconContainer.classList.remove('bg-gray-700');
            }

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeModal();
        }


        // =================================================================
        // 4. è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯
        // =================================================================

        /**
         * åŸºç¤ç›¸æ€§å€¤ã‚’å–å¾—ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
         */
        function getBaseComp(youngerName, olderName) {
            const youngerData = BASE_COMPATIBILITY[youngerName];
            if (!youngerData) {
                console.error(`Error: Younger monster data not found for ${youngerName}`);
                return 0;
            }
            const compValue = youngerData[olderName];
            if (compValue === undefined) {
                console.error(`Error: Compatibility value not found for ${youngerName} -> ${olderName}`);
                return 0;
            }
            return compValue;
        }

        /**
         * ç›¸æ€§å€¤ã®è¨ˆç®—ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
         */
        function calculateCompValue(childName, selectedMonsters, secret3Count, secret2Count, nobleAdd) {
            const { P1, Gf1, Gm1, P2, Gf2, Gm2 } = selectedMonsters;

            // åŸºç¤ç›¸æ€§å€¤ã®ãƒ‘ãƒ¼ãƒ„
            const comp_C_P1 = getBaseComp(childName, P1);
            const comp_P1_Gf1 = getBaseComp(P1, Gf1);
            const comp_C_Gf1 = getBaseComp(childName, Gf1);
            const comp_P1_Gm1 = getBaseComp(P1, Gm1);
            const comp_C_Gm1 = getBaseComp(childName, Gm1);

            const comp_C_P2 = getBaseComp(childName, P2);
            const comp_P2_Gf2 = getBaseComp(P2, Gf2);
            const comp_C_Gf2 = getBaseComp(childName, Gf2);
            const comp_P2_Gm2 = getBaseComp(P2, Gm2);
            const comp_C_Gm2 = getBaseComp(childName, Gm2);

            const comp_P1_P2 = getBaseComp(P1, P2);

            // ç›¸æ€§å€¤ã®è¨ˆç®—å¼
            let totalComp = 0;

            // 1. çˆ¶å´ãƒ©ã‚¤ãƒ³
            totalComp += comp_C_P1;
            totalComp += Math.min(comp_P1_Gf1, comp_C_Gf1);
            totalComp += Math.min(comp_P1_Gm1, comp_C_Gm1);

            // 2. æ¯å´ãƒ©ã‚¤ãƒ³
            totalComp += comp_C_P2;
            totalComp += Math.min(comp_P2_Gf2, comp_C_Gf2);
            totalComp += Math.min(comp_P2_Gm2, comp_C_Gm2);

            // 3. ä¸¡è¦ª
            totalComp += comp_P1_P2;

            // 4. å›ºå®šå€¤ã¨åŠ ç®—å€¤
            totalComp += 224;
            totalComp += (secret2Count * 5);
            totalComp += (secret3Count * 12.5);
            totalComp += nobleAdd;

            return totalComp;
        }

        /**
         * ç›¸æ€§å€¤ã«åŸºã¥ã„ã¦ç›¸æ€§ã‚·ãƒ³ãƒœãƒ«ã‚’æ±ºå®šã™ã‚‹é–¢æ•°
         */
        function getCompSymbol(value) {
            if (value >= 660) return { symbol: 'ğŸ‘‘', class: 'symbol-crown text-3xl' };
            if (value >= 614) return { symbol: 'â˜†', class: 'symbol-star text-2xl' };
            if (value >= 490) return { symbol: 'â—', class: 'symbol-double-circle text-2xl' };
            if (value >= 374) return { symbol: 'â—‹', class: 'symbol-circle text-xl' };
            if (value >= 255) return { symbol: 'â–³', class: 'symbol-triangle text-xl' };
            return { symbol: 'Ã—', class: 'symbol-x text-xl' };
        }

        // =================================================================
        // 5. ãƒ¡ã‚¤ãƒ³å‡¦ç†ã¨ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        // =================================================================

        document.addEventListener('DOMContentLoaded', () => {
            const resultList = document.getElementById('result-list');
            const errorMessage = document.getElementById('error-message');
            const calculateBtn = document.getElementById('calculate-btn');
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã«ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
            const monsterListDiv = document.getElementById('monster-list');
            MONSTERS.forEach(m => {
                const button = document.createElement('button');
                button.className = 'flex flex-col items-center p-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors';
                button.innerHTML = `
                    <div class="monster-icon-container mb-1">
                        <!-- GitHub Pagesãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€åŒéšå±¤ã®imageãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ -->
                        <img src="${m.imageUrl}" alt="${m.name} icon" class="monster-icon-img"
                            onerror="this.parentNode.innerHTML='<span class=\\'text-sm font-bold text-white\\' style=\\'background-color: ${m.color}; padding: 0.5rem; border-radius: 50%;\\'>${m.short}</span>'; this.parentNode.style.backgroundColor='transparent';"
                        >
                    </div>
                    <span class="text-xs font-medium text-white">${m.name}</span>
                `;
                button.onclick = () => selectMonster(m.name);
                monsterListDiv.appendChild(button);
            });

            // ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼é¸æŠãƒœã‚¿ãƒ³ã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            document.querySelectorAll('.monster-select-btn').forEach(button => {
                button.addEventListener('click', () => openModal(button.dataset.target));
            });

            // è¨ˆç®—ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            calculateBtn.addEventListener('click', () => {
                // 1. ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯
                const requiredMonsters = ['P1', 'Gf1', 'Gm1', 'P2', 'Gf2', 'Gm2'];
                const missingMonster = requiredMonsters.find(key => !state[key]);

                if (missingMonster) {
                    errorMessage.textContent = 'è­¦å‘Š: 6ä½“ã™ã¹ã¦ã®ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚';
                    errorMessage.classList.remove('hidden');
                    resultList.innerHTML = '';
                    return;
                }
                
                const allSelected = requiredMonsters.map(key => state[key]);
                const unknownMonster = allSelected.find(name => !BASE_COMPATIBILITY[name] || !BASE_COMPATIBILITY[name][name]);

                if (unknownMonster) {
                    errorMessage.textContent = `ã‚¨ãƒ©ãƒ¼: é¸æŠã•ã‚ŒãŸãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã€Œ${unknownMonster}ã€ã®åŸºç¤ç›¸æ€§ãƒ‡ãƒ¼ã‚¿ãŒãƒ†ãƒ¼ãƒ–ãƒ«ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚`;
                    errorMessage.classList.remove('hidden');
                    resultList.innerHTML = '';
                    return;
                }

                errorMessage.classList.add('hidden');
                
                // 2. å…¥åŠ›å€¤ã®å–å¾—
                const secret3Count = parseFloat(document.getElementById('secret3').value) || 0;
                const secret2Count = parseFloat(document.getElementById('secret2').value) || 0;
                const nobleAdd = parseFloat(document.getElementById('noble-add').value) || 0;

                // 3. å…¨ã¦ã®ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ã«å¯¾ã—ã¦ç›¸æ€§å€¤ã‚’è¨ˆç®—
                const results = [];
                MONSTER_NAMES.forEach(childName => {
                    try {
                        const compValue = calculateCompValue(
                            childName,
                            state,
                            secret3Count,
                            secret2Count,
                            nobleAdd
                        );
                        
                        const { symbol, class: symbolClass } = getCompSymbol(compValue);
                        
                        results.push({
                            name: childName,
                            value: compValue,
                            symbol: symbol,
                            symbolClass: symbolClass,
                            monsterData: MONSTERS.find(m => m.name === childName)
                        });
                    } catch (e) {
                        console.error(`Calculation failed for ${childName}:`, e);
                    }
                });

                // 4. ç›¸æ€§å€¤ã§é™é †ã‚½ãƒ¼ãƒˆ
                results.sort((a, b) => b.value - a.value);

                // 5. çµæœã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                resultList.innerHTML = '';

                if (results.length === 0) {
                    resultList.innerHTML = '<p class="col-span-full text-center text-gray-500 mt-8">è¨ˆç®—çµæœãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>';
                    return;
                }

                results.forEach(res => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex flex-col items-center bg-gray-700 p-3 rounded-lg shadow-md hover:bg-gray-600 transition-colors cursor-default border border-gray-600';
                    itemDiv.innerHTML = `
                        <div class="monster-icon-container mb-2 w-10 h-10">
                             <!-- GitHub Pagesãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€åŒéšå±¤ã®imageãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ -->
                            <img src="${res.monsterData.imageUrl}" alt="${res.name} icon" class="monster-icon-img" 
                                onerror="this.parentNode.innerHTML='<span class=\\'text-sm font-bold text-white\\' style=\\'background-color: ${res.monsterData.color}; padding: 0.5rem; border-radius: 50%;\\'>${res.monsterData.short}</span>'; this.parentNode.style.backgroundColor='transparent';"
                            >
                        </div>
                        <span class="text-sm font-semibold text-white truncate w-full text-center">${res.name}</span>
                        <div class="flex items-center space-x-1 mt-1">
                            <span class="text-base font-bold text-indigo-300">${res.value.toFixed(1)}</span>
                            <span class="${res.symbolClass}">${res.symbol}</span>
                        </div>
                    `;
                    resultList.appendChild(itemDiv);
                });
            });
        });
    </script>
</body>
</html>